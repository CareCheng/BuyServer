# KamiServer 用户使用说明书

## 目录

- [第一章 系统概述](#第一章-系统概述)
- [第二章 程序安装与启动](#第二章-程序安装与启动)
- [第三章 用户前台功能](#第三章-用户前台功能)
- [第四章 用户中心](#第四章-用户中心)
- [第五章 在线客服系统](#第五章-在线客服系统)
- [第六章 管理后台](#第六章-管理后台)
- [第七章 客服工作台](#第七章-客服工作台)
- [第八章 常见问题](#第八章-常见问题)

---

## 第一章 系统概述

### 1.1 系统简介

KamiServer 是一个功能完整的卡密销售管理系统，提供商品浏览、在线购买、多种支付方式、在线客服等功能。系统分为以下几个部分：

| 模块 | 说明 | 访问地址 |
|------|------|----------|
| 用户前台 | 商品浏览、购买、订单查询 | 网站首页 `/` |
| 用户中心 | 个人信息、订单管理、钱包 | `/user` |
| 在线客服 | 工单系统、实时聊天 | `/message` |
| 管理后台 | 系统管理（管理员专用） | `/manage`（可自定义） |
| 客服工作台 | 客服人员专用 | `/staff` |

### 1.2 技术架构

| 组件 | 技术 |
|------|------|
| 后端 | Go + Gin + GORM |
| 前端 | React + Next.js + TypeScript |
| 数据库 | MySQL / PostgreSQL / SQLite |
| 实时通信 | WebSocket |

### 1.3 系统要求

- 现代浏览器（Chrome、Firefox、Edge、Safari 最新版本）
- 稳定的网络连接
- 建议屏幕分辨率 1280×720 以上

### 1.4 主要功能

- 🛒 商品管理：分类、多图展示、手动卡密
- 💳 多种支付：支付宝、微信、PayPal、Stripe、USDT、易支付、余额
- 👤 用户系统：注册登录、2FA、邮箱验证、设备管理
- 💰 余额积分：充值、消费、充值优惠、积分兑换
- 🎫 订单系统：创建、支付、查询、优惠券
- 💬 客服系统：工单、实时聊天、知识库、智能回复
- 🔧 管理后台：仪表盘、多管理员、权限管理、数据备份


---

## 第二章 程序安装与启动

### 2.1 文件结构

程序解压后包含以下文件和文件夹：

| 文件/文件夹 | 说明 |
|-------------|------|
| `UserFrontend.exe` | 主程序（Windows）|
| `UserFrontend` | 主程序（Linux）|
| `start.bat` | Windows 启动脚本 |
| `web/` | 网页资源文件夹（非嵌入模式）|
| `Product/` | 商品图片存储文件夹 |
| `user_config/` | 配置文件夹 |
| `backups/` | 数据库备份文件夹 |
| `server_log/` | 操作日志文件夹 |

### 2.2 构建程序

如果从源码构建：

```bash
# Windows
.\build.ps1

# Linux
./build.sh

# 嵌入模式（单文件部署，包含前端资源）
.\build.ps1 --embed
./build.sh --embed
```

### 2.3 首次启动

#### Windows 系统

1. 双击 `start.bat` 或直接双击 `UserFrontend.exe`
2. 程序启动后会显示访问地址，默认为 `http://localhost:8080`
3. 打开浏览器，输入显示的地址即可访问

#### Linux 系统

```bash
# 赋予执行权限
chmod +x UserFrontend

# 启动程序
./UserFrontend
```

### 2.4 首次配置向导

首次启动时，系统会自动进入配置向导。

#### 第一步：数据库配置

| 数据库类型 | 适用场景 | 配置要求 |
|------------|----------|----------|
| SQLite | 小型站点、测试环境 | 无需额外配置（推荐新手）|
| MySQL | 中大型站点 | 需要 MySQL 服务器 |
| PostgreSQL | 大型站点 | 需要 PostgreSQL 服务器 |

**SQLite 配置：**
- 选择数据库类型为 SQLite
- 数据库名称填写文件名，如 `data.db`
- 点击"测试连接"确认后保存

**MySQL/PostgreSQL 配置：**
- 填写数据库服务器地址
- 填写端口号（MySQL 默认 3306，PostgreSQL 默认 5432）
- 填写数据库用户名和密码
- 填写数据库名称（需提前创建）
- 点击"测试连接"确认后保存

#### 第二步：管理员账号设置

- 设置管理员用户名（默认 admin）
- 设置管理员密码（建议使用强密码）
- 设置管理后台访问路径（默认 manage，可自定义提高安全性）

### 2.5 后台运行

**Windows：** 使用 NSSM 等工具注册为 Windows 服务

**Linux：** 使用 systemd 或 screen/tmux

```bash
# 使用 screen
screen -S kamiserver
./UserFrontend
# Ctrl+A+D 分离会话

# 使用 systemd
sudo systemctl enable kamiserver
sudo systemctl start kamiserver
```


---

## 第三章 用户前台功能

### 3.1 首页

访问网站首页可以看到：

- **公告栏**：显示管理员发布的最新公告
- **商品分类**：按分类浏览商品
- **商品列表**：展示所有上架商品
- **导航栏**：首页、商品、FAQ、登录/注册等入口

### 3.2 商品浏览

#### 商品列表页

- 按分类筛选商品
- 按价格、销量等排序
- 搜索商品名称
- 查看商品基本信息

#### 商品详情页

- 商品图片（支持多图浏览）
- 商品名称和价格
- 商品详细描述
- 有效期信息
- 库存状态
- 用户评价
- 购买按钮

### 3.3 用户注册

1. **填写基本信息**
   - 用户名：4-20 个字符，支持字母、数字、下划线
   - 邮箱：用于接收验证码和订单通知
   - 密码：至少 6 个字符

2. **邮箱验证**
   - 点击"发送验证码"
   - 查收邮箱验证码（有效期 10 分钟）
   - 输入验证码完成验证

3. **完成注册**
   - 点击"注册"按钮
   - 注册成功后跳转到登录页面

### 3.4 用户登录

#### 普通登录

1. 输入用户名或邮箱
2. 输入密码
3. 输入图形验证码（如有）
4. 点击"登录"

#### 两步验证登录（如已开启）

- **TOTP 验证**：打开手机验证器应用，输入 6 位动态验证码
- **邮箱验证**：输入发送到邮箱的验证码

### 3.5 找回密码

1. 点击登录页面"忘记密码"
2. 输入注册邮箱
3. 点击"发送验证码"
4. 输入验证码
5. 设置新密码
6. 点击"重置密码"

### 3.6 购买商品

#### 创建订单

1. 在商品详情页点击"立即购买"
2. 选择购买数量
3. 如有优惠券，输入优惠券码
4. 确认订单信息
5. 点击"提交订单"

#### 支付方式

| 支付方式 | 说明 |
|----------|------|
| 支付宝 | 扫码支付 |
| 微信支付 | 扫码支付 |
| PayPal | 国际支付 |
| Stripe | 国际信用卡支付 |
| USDT | 加密货币支付（TRC20/ERC20/BEP20）|
| 易支付 | 第三方聚合支付 |
| 余额支付 | 使用账户余额 |

#### 获取卡密

支付成功后：
- 页面显示购买的卡密
- 可点击"复制"按钮复制卡密
- 多个卡密可点击"导出 CSV"下载
- 卡密同时发送到注册邮箱
- 可在用户中心随时查看

### 3.7 订单查询（未登录）

1. 点击导航栏"订单查询"
2. 输入订单号
3. 输入下单时使用的邮箱
4. 点击"查询"
5. 查看订单详情和卡密

### 3.8 FAQ 帮助中心

- 按分类浏览常见问题
- 搜索问题关键词
- 查看问题详细解答
- 对答案进行反馈


---

## 第四章 用户中心

访问路径：登录后点击导航栏用户头像或"用户中心"

### 4.1 账户设置

#### 基本信息

- 查看用户名、邮箱、注册时间
- 修改头像
- 绑定/更换邮箱

#### 修改密码

1. 点击"修改密码"
2. 输入当前密码
3. 输入新密码并确认
4. 点击"确认修改"

#### 两步验证（2FA）

**TOTP 验证器（推荐）：**
1. 点击"启用 TOTP 验证"
2. 使用手机下载验证器应用（Google Authenticator、Microsoft Authenticator 等）
3. 扫描页面显示的二维码
4. 输入验证器显示的 6 位数字
5. 保存恢复密钥（重要！）

**邮箱验证：**
- 点击"启用邮箱验证"
- 每次登录时会发送验证码到邮箱

#### 登录设备管理

- 查看所有登录过的设备
- 查看设备类型、登录时间、IP 地址
- 移除可疑设备（强制下线）
- 一键移除所有其他设备

#### 账户注销

1. 点击"申请注销账户"
2. 阅读注销须知
3. 输入密码确认
4. 提交注销申请

> ⚠️ 账户注销后数据将被删除，无法恢复

### 4.2 我的订单

#### 订单列表

- 查看所有历史订单
- 按状态筛选（全部/待支付/已完成/已取消）
- 搜索订单号或商品名称

#### 订单状态说明

| 状态 | 说明 |
|------|------|
| 待支付 | 订单已创建，等待付款 |
| 已支付 | 付款成功，正在处理 |
| 已完成 | 订单完成，已发放卡密 |
| 已取消 | 订单已取消 |
| 已退款 | 订单已退款 |
| 已过期 | 超时未支付，订单自动取消 |

#### 订单详情

- 订单号、下单时间
- 商品信息、购买数量
- 支付金额、支付方式
- 卡密信息（已完成订单）
- 复制卡密、导出卡密

### 4.3 我的卡密

- 查看所有购买的卡密
- 显示商品名称、卡密内容、到期时间
- 状态标识（有效/即将过期/已过期）
- 复制、导出、续费功能

### 4.4 我的钱包

#### 余额查看

- 当前可用余额
- 累计充值金额
- 累计消费金额

#### 余额充值

1. 点击"充值"按钮
2. 输入充值金额
3. 查看充值优惠（如有活动）
4. 选择支付方式
5. 完成支付
6. 余额自动到账

#### 支付密码

1. 点击"设置支付密码"
2. 输入 6 位数字密码
3. 确认密码
4. 设置成功

#### 余额明细

- 充值记录
- 消费记录
- 退款记录
- 赠送记录

### 4.5 购物车

- 添加商品到购物车
- 修改商品数量
- 删除商品
- 批量结算

### 4.6 我的收藏

- 查看收藏的商品
- 快速进入商品详情
- 取消收藏
- 加入购物车

### 4.7 我的发票

- 申请发票（选择订单、填写抬头）
- 管理发票抬头
- 查看发票记录
- 下载电子发票


---

## 第五章 在线客服系统

访问路径：点击导航栏"客服"或页面右下角客服图标

### 5.1 工单系统

适用于非紧急问题，客服会在工作时间内回复。

#### 创建工单

1. 点击"提交工单"
2. 填写工单信息：
   - 主题：简要描述问题
   - 分类：选择问题类型
   - 优先级：普通/紧急/非常紧急
   - 关联订单：如与订单相关，填写订单号
   - 详细描述：详细说明问题
   - 附件：可上传截图等文件
3. 点击"提交"

#### 工单状态说明

| 状态 | 说明 |
|------|------|
| 待处理 | 工单已提交，等待客服处理 |
| 处理中 | 客服正在处理 |
| 已回复 | 客服已回复，等待用户确认 |
| 已解决 | 问题已解决 |
| 已关闭 | 工单已关闭 |

#### 评价工单

工单解决后可以评价：
1. 点击"评价"按钮
2. 选择满意度（1-5 星）
3. 填写评价内容（可选）
4. 提交评价

### 5.2 实时聊天

适用于简单问题，可即时与客服沟通。

1. 点击"在线咨询"或聊天图标
2. 等待客服接入（显示排队人数）
3. 客服接入后开始对话
4. 支持发送文字、图片
5. 点击"结束对话"结束聊天

### 5.3 游客咨询

未登录用户也可以使用客服系统：

1. 点击客服入口
2. 输入联系邮箱（用于接收回复通知）
3. 提交工单或发起聊天
4. 系统生成访问令牌
5. 通过令牌或邮箱链接查看回复


---

## 第六章 管理后台

访问路径：默认为 `/manage`（可在配置中自定义）

### 6.1 登录管理后台

1. 访问管理后台地址
2. 输入管理员用户名和密码
3. 如启用两步验证，输入验证码
4. 点击"登录"

> 首次访问时，系统会引导您设置管理员密码。默认用户名为 `admin`。

### 6.2 仪表盘

登录后首先看到仪表盘，显示：

- 今日订单数、销售额
- 本周/本月统计
- 用户总数、商品总数
- 最近订单列表
- 销售趋势图表

### 6.3 商品管理

#### 商品列表

- 查看所有商品
- 按分类、状态筛选
- 搜索商品名称
- 批量操作（上架/下架/删除）

#### 添加商品

1. 点击"添加商品"
2. 填写商品信息：
   - 商品名称、分类、价格
   - 有效期（天/周/月/年）
   - 库存（-1 表示无限）
   - 商品描述、商品图片
3. 商品类型默认为手动卡密
4. 点击"保存"

#### 手动卡密管理

1. 进入商品编辑页面
2. 点击"卡密管理"
3. 导入卡密：每行一个卡密，点击"确认导入"
4. 管理卡密：查看状态、禁用/启用、删除

#### 商品分类管理

- 添加分类：填写名称、图标、排序
- 编辑/删除分类

### 6.4 订单管理

- 查看所有订单
- 按状态、时间、支付方式筛选
- 搜索订单号、用户名、邮箱
- 导出订单数据
- 查看订单详情和卡密
- 重新发送卡密邮件

### 6.5 用户管理

- 查看所有注册用户
- 按状态筛选（正常/禁用）
- 搜索用户名、邮箱
- 查看用户详情和订单
- 禁用/启用用户
- 重置用户密码

### 6.6 内容管理

#### 公告管理

- 添加公告：标题、内容、类型、显示时间
- 编辑/删除/启用/禁用公告

#### FAQ 管理

- 管理 FAQ 分类
- 添加常见问题和答案
- 查看问题反馈统计

#### 优惠券管理

- 创建优惠券：优惠券码、优惠类型、金额/比例
- 设置最低消费、使用次数、有效期
- 查看使用记录

#### 商品评价管理

- 查看所有商品评价
- 回复评价
- 隐藏/删除违规评价

### 6.7 余额管理

- 查看用户余额
- 调整用户余额（增加/扣减）
- 查看充值订单
- 创建充值优惠活动
- 配置充值限额
- 查看余额告警

### 6.8 积分管理

- 设置积分获取规则（注册、购物、评价、签到）
- 设置积分兑换项目（优惠券、余额、商品）
- 查看和调整用户积分

### 6.9 发票管理

- 查看发票申请
- 处理发票（开具/拒绝）
- 配置发票功能

### 6.10 客服系统管理

#### 客服配置

- 启用/禁用客服系统
- 设置是否允许游客咨询
- 设置工作时间
- 设置离线提示和欢迎消息
- 配置工单分类

#### 客服人员管理

- 添加客服：用户名、密码、角色
- 编辑/禁用/启用客服账号
- 重置客服密码

#### 知识库管理

- 创建知识库分类和文章
- 客服可在回复时快速引用

#### 工单模板

- 创建常用工单回复模板

#### 智能客服

- 配置自动回复规则
- 添加关键词触发规则


### 6.11 系统配置

#### 基本设置

- 网站名称、Logo
- 联系邮箱、版权信息

#### 支付配置

| 支付方式 | 配置项 |
|----------|--------|
| 支付宝当面付 | 应用 ID、应用私钥、支付宝公钥 |
| 微信支付 | 商户号、API 密钥、证书文件 |
| PayPal | Client ID、Client Secret、环境 |
| Stripe | Publishable Key、Secret Key、Webhook Secret |
| USDT | 钱包地址、网络类型、汇率 |
| 易支付 | 商户 ID、商户密钥、网关地址 |

#### 邮箱配置

- SMTP 服务器地址和端口
- 发件人邮箱和密码/授权码
- 发件人名称
- 测试发送功能

#### 数据库配置

- 查看当前数据库配置
- 修改数据库连接
- 查看加密密钥（用于数据迁移）

#### 安全设置

- 登录失败锁定次数和时间
- IP 黑名单自动封禁
- 验证码设置

### 6.12 系统管理

#### 操作日志

- 查看所有操作日志
- 按日期、操作类型、用户筛选
- 导出日志

#### 数据备份

- 手动备份：点击"立即备份"
- 查看备份列表
- 下载/删除备份

#### 系统监控

- CPU、内存使用率
- 数据库状态
- 在线用户数
- 请求统计

#### 定时任务

- 订单过期检查
- 数据库自动备份
- 日志清理

#### IP 黑名单

- 查看被封禁的 IP
- 手动添加/移除黑名单

#### 管理员账号

- 添加管理员
- 设置管理员角色和权限
- 修改/禁用/删除管理员

#### 角色权限

- 创建角色
- 配置角色权限
- 分配角色给管理员

### 6.13 数据统计

- 按日/周/月/年查看销售数据
- 销售额和订单量趋势图
- 商品销售排行
- 新增用户趋势
- 活跃用户统计


---

## 第七章 客服工作台

访问路径：`/staff/login`

### 7.1 客服登录

1. 访问客服登录页面
2. 输入客服用户名和密码
3. 如启用两步验证，输入验证码
4. 点击"登录"

### 7.2 工作台概览

- 待处理工单数
- 进行中工单数
- 今日处理数
- 等待接入的聊天数
- 工单列表

### 7.3 工单处理

#### 处理工单

1. 点击工单进入详情
2. 查看用户问题描述
3. 查看关联订单信息（如有）
4. 回复用户（可使用知识库快速回复）
5. 更新工单状态
6. 添加内部备注（用户不可见）

#### 工单转接

1. 点击"转接"
2. 选择目标客服
3. 填写转接原因
4. 确认转接

### 7.4 实时聊天

1. 查看等待队列
2. 点击"接入"接待用户
3. 发送文字、图片消息
4. 使用快捷回复
5. 点击"结束对话"结束聊天

### 7.5 知识库

- 按分类浏览
- 搜索关键词
- 在回复时点击"引用"插入内容

### 7.6 个人设置

- 修改密码
- 启用/禁用两步验证
- 设置在线状态（在线/离开）


---

## 第八章 常见问题

### 8.1 启动问题

#### Q：程序启动后无法访问

检查以下几点：
1. 确认程序正在运行（查看命令行窗口）
2. 确认访问地址正确（默认 `http://localhost:8080`）
3. 检查端口是否被占用
4. 检查防火墙是否阻止了访问

#### Q：提示端口被占用

解决方法：
1. 关闭占用端口的程序
2. 或修改配置使用其他端口

#### Q：数据库连接失败

检查：
1. 数据库服务是否启动
2. 数据库地址、端口是否正确
3. 用户名、密码是否正确
4. 数据库是否已创建

### 8.2 用户问题

#### Q：收不到验证码邮件

检查：
1. 邮箱地址是否正确
2. 检查垃圾邮件文件夹
3. 联系管理员确认邮箱配置

#### Q：忘记密码怎么办

使用"忘记密码"功能通过邮箱验证重置密码。

#### Q：两步验证手机丢失

解决方法：
1. 使用保存的恢复密钥
2. 或联系管理员重置两步验证

### 8.3 支付问题

#### Q：支付成功但没有收到卡密

1. 等待几分钟，系统可能正在处理
2. 刷新页面或重新登录
3. 在用户中心"我的订单"查看
4. 检查邮箱是否收到卡密邮件
5. 如仍未收到，联系客服处理

#### Q：支付页面打不开

1. 检查网络连接
2. 尝试更换浏览器
3. 清除浏览器缓存
4. 联系管理员确认支付配置

#### Q：余额支付提示支付密码错误

1. 确认输入的支付密码正确
2. 如忘记支付密码，点击"忘记支付密码"重置
3. 连续错误 5 次会锁定 30 分钟

### 8.4 管理问题

#### Q：管理后台无法登录

1. 确认访问地址正确（后缀可能已修改）
2. 确认用户名密码正确
3. 检查是否被锁定（等待解锁或重启程序）

#### Q：如何修改管理后台地址

在管理后台"系统设置"中修改"管理后台路径"，保存后使用新地址访问。

#### Q：如何备份数据

1. 在管理后台"数据备份"中点击"立即备份"
2. 或直接复制数据库文件（SQLite）

### 8.5 其他问题

#### Q：如何更新程序

1. 备份当前数据（数据库、配置文件）
2. 停止当前程序
3. 替换程序文件（保留 `user_config`、`Product`、`backups` 文件夹）
4. 启动新程序
5. 检查功能是否正常

#### Q：如何迁移到新服务器

1. 在旧服务器备份数据库
2. 复制加密密钥（管理后台数据库配置中查看）
3. 在新服务器安装程序
4. 配置相同的加密密钥
5. 导入数据库备份
6. 复制 `Product` 文件夹（商品图片）
7. 启动程序并测试

#### Q：程序支持 HTTPS 吗

支持。可以通过以下方式启用：
1. 使用 Nginx 等反向代理（推荐）
2. 在配置中启用 HTTPS 并配置证书


---

## 附录

### 附录 A：快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+C` | 复制 |
| `Ctrl+V` | 粘贴 |
| `Enter` | 发送消息（聊天中）|
| `Esc` | 关闭弹窗 |

### 附录 B：HTTP 状态码说明

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未登录或登录过期 |
| 403 | 无权限访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

### 附录 C：订单状态流转

```
创建订单 → 待支付 → 已支付 → 已完成
              ↓
           已取消/已过期
              
已完成 → 已退款（管理员操作）
```

### 附录 D：文件目录说明

| 目录 | 说明 | 是否需要备份 |
|------|------|--------------|
| `user_config/` | 配置文件 | ✅ 是 |
| `Product/` | 商品图片 | ✅ 是 |
| `backups/` | 数据库备份 | ✅ 是 |
| `server_log/` | 操作日志 | 可选 |
| `web/` | 前端资源 | ❌ 否（可重新构建）|

### 附录 E：联系方式

如有问题，请通过以下方式联系：
- 在线客服：网站右下角客服图标
- 工单系统：用户中心 → 客服 → 提交工单
- GitHub Issues：[项目地址](https://github.com/your-repo/kamiserver)

---

## 更新日志

### v1.0.0 (2025-01)

- 🎉 首次发布
- ✨ 商品管理：分类、多图展示、手动卡密
- ✨ 订单系统：创建、支付、查询
- ✨ 多种支付方式：支付宝、微信、PayPal、Stripe、USDT、易支付
- ✨ 用户系统：注册登录、2FA、邮箱验证、设备管理
- ✨ 余额积分系统：充值、消费、充值优惠、积分兑换
- ✨ 客服系统：工单、实时聊天、知识库、智能回复
- ✨ 管理后台：仪表盘、多管理员、权限管理、数据备份

---

*本说明书最后更新时间：2025年1月*

*本项目采用 [GPL v3](LICENSE) 开源许可证*
