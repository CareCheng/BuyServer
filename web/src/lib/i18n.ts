/**
 * 国际化（i18n）配置
 * 支持中文和英文界面切换
 */

// 支持的语言列表
export const locales = ['zh', 'en'] as const
export type Locale = typeof locales[number]

// 默认语言
export const defaultLocale: Locale = 'zh'

// 语言名称映射
export const localeNames: Record<Locale, string> = {
  zh: '中文',
  en: 'English',
}

// 中文翻译
const zhTranslations = {
  // 通用
  common: {
    loading: '加载中...',
    submit: '提交',
    cancel: '取消',
    confirm: '确认',
    save: '保存',
    delete: '删除',
    edit: '编辑',
    search: '搜索',
    reset: '重置',
    back: '返回',
    close: '关闭',
    copy: '复制',
    copied: '已复制',
    success: '成功',
    error: '错误',
    warning: '警告',
    info: '提示',
    yes: '是',
    no: '否',
    all: '全部',
    none: '无',
    more: '更多',
    less: '收起',
    noData: '暂无数据',
    required: '必填',
    optional: '选填',
    next: '下一步',
    prev: '上一步',
    verify: '验证',
    send: '发送',
    sending: '发送中...',
    seconds: '秒',
    clickRefresh: '点击刷新',
    fillComplete: '请填写完整信息',
  },
  // 认证相关
  auth: {
    login: '登录',
    register: '注册',
    logout: '退出登录',
    loginTitle: '用户登录',
    loginSubtitle: '欢迎回来，请登录您的账号',
    registerTitle: '用户注册',
    registerSubtitle: '创建您的账号，开始购买',
    forgotTitle: '找回密码',
    forgotStep1: '请输入您的用户名',
    forgotStep2: '请验证您的身份',
    forgotStep3: '请设置您的新密码',
    verifyTitle: '二次验证',
    verifySubtitle: '为保护您的账号安全，请完成二次验证',
    noAccount: '没有账号？立即注册',
    hasAccount: '已有账号？立即登录',
    forgotPassword: '忘记密码？',
    backToLogin: '返回登录',
    backToHome: '返回首页',
    registerNewAccount: '注册新账号',
    loginSuccess: '登录成功',
    loginFailed: '登录失败',
    registerSuccess: '注册成功，即将跳转登录',
    registerFailed: '注册失败',
    verifySuccess: '验证成功',
    verifyFailed: '验证码错误',
    resetSuccess: '密码重置成功，即将跳转登录',
    resetFailed: '重置失败',
    invalidRequest: '无效的验证请求',
    infoExpired: '验证信息已过期',
    userNotFound: '用户不存在或未绑定邮箱',
  },
  // 导航
  nav: {
    home: '首页',
    products: '商品列表',
    user: '用户中心',
    login: '登录',
    register: '注册',
    logout: '退出登录',
    faq: '常见问题',
    support: '客服支持',
    cart: '购物车',
  },
  // 用户相关
  user: {
    username: '用户名',
    usernamePlaceholder: '3-20个字符',
    password: '密码',
    passwordPlaceholder: '请输入密码',
    passwordMinLength: '至少6位',
    passwordMismatch: '两次密码不一致',
    passwordTooShort: '密码长度至少6位',
    confirmPassword: '确认密码',
    confirmPasswordPlaceholder: '再次输入密码',
    confirmNewPassword: '确认新密码',
    confirmNewPasswordPlaceholder: '再次输入新密码',
    email: '邮箱',
    emailPlaceholder: '用于验证和找回密码',
    emailInvalid: '请输入有效的邮箱地址',
    emailFirst: '请先输入邮箱地址',
    phone: '手机号',
    phonePlaceholder: '选填',
    phoneOptional: '手机号（可选）',
    avatar: '头像',
    profile: '个人资料',
    settings: '设置',
    orders: '我的订单',
    balance: '余额',
    recharge: '充值',
    logoutSuccess: '已退出登录',
    pleaseLogin: '请先登录',
    rememberMe: '记住我',
    resetPassword: '重置密码',
    changePassword: '修改密码',
    oldPassword: '原密码',
    newPassword: '新密码',
    newPasswordPlaceholder: '至少6位',
    twoFactorAuth: '两步验证',
    enable2FA: '启用两步验证',
    disable2FA: '禁用两步验证',
    verificationCode: '验证码',
    captcha: '图形验证码',
    captchaPlaceholder: '请输入验证码',
    emailCode: '邮箱验证码',
    emailCodePlaceholder: '请输入{length}位验证码',
    sendCode: '发送验证码',
    codeSent: '验证码已发送，请查收邮件',
    codeSendFailed: '发送失败',
    codeCorrect: '验证码正确',
    codeIncorrect: '验证码错误或已过期',
    totpCode: '动态口令',
    totpPlaceholder: '000000',
    totpHint: '请输入您验证器APP中的动态口令',
    totpVerify: '动态口令验证',
    emailVerify: '邮箱验证码验证',
    openAuthApp: '请打开验证器APP查看当前验证码',
    codeSendTo: '验证码将发送到',
    verifyLogin: '验证登录',
    enter6DigitCode: '请输入6位验证码',
    enter6DigitTotp: '请输入6位动态口令',
    welcome: '欢迎',
    hi: 'Hi',
  },
  // 商品相关
  product: {
    name: '商品名称',
    description: '商品描述',
    noDescription: '暂无描述',
    price: '价格',
    stock: '库存',
    stockStatus: '库存状态',
    stockSufficient: '库存充足',
    stockLow: '库存紧张',
    stockRemaining: '剩余',
    stockUnit: '件',
    outOfStock: '已售罄',
    duration: '有效期',
    category: '分类',
    image: '图片',
    detail: '商品详情',
    specs: '规格参数',
    features: '产品特性',
    reviews: '商品评价',
    reviewCount: '条评价',
    noReviews: '暂无评价，购买后可以发表评价',
    buyNow: '立即购买',
    addToCart: '加入购物车',
    addedToCart: '已添加到购物车',
    addFailed: '添加失败',
    quantity: '数量',
    purchaseQuantity: '购买数量',
    total: '总计',
    totalPrice: '总价',
    productList: '商品列表',
    noProducts: '暂无商品',
    searchPlaceholder: '搜索商品名称或描述...',
    sortDefault: '默认排序',
    sortPriceAsc: '价格从低到高',
    sortPriceDesc: '价格从高到低',
    foundProducts: '找到 {count} 个商品',
    noMatchingProducts: '没有找到匹配的商品',
    tryOtherKeywords: '试试其他关键词？',
    clearSearch: '清除搜索',
    confirmPurchase: '确认购买',
    purchaseSuccess: '购买成功',
    congratulations: '恭喜您，购买成功！',
    orderCreated: '订单创建成功，正在跳转支付页面...',
    orderCreateFailed: '创建订单失败',
    addToFavorite: '添加收藏',
    removeFromFavorite: '取消收藏',
    addedToFavorite: '已添加到收藏',
    removedFromFavorite: '已取消收藏',
    operationFailed: '操作失败',
    merchantReply: '商家回复',
    score: '分',
  },
  // 订单相关
  order: {
    orderNo: '订单号',
    status: '订单状态',
    createTime: '创建时间',
    paymentTime: '支付时间',
    paymentMethod: '支付方式',
    amount: '金额',
    kamiCode: '卡密',
    pending: '待支付',
    paid: '已支付',
    completed: '已完成',
    cancelled: '已取消',
    refunded: '已退款',
    expired: '已过期',
    createOrder: '创建订单',
    cancelOrder: '取消订单',
    payNow: '立即支付',
    orderDetail: '订单详情',
    orderList: '订单列表',
    noOrders: '暂无订单',
    orderSuccess: '下单成功',
    orderFailed: '下单失败',
    paymentSuccess: '支付成功',
    paymentFailed: '支付失败',
    copyKami: '复制卡密',
  },
  // 支付相关
  payment: {
    selectMethod: '选择支付方式',
    alipay: '支付宝',
    wechat: '微信支付',
    paypal: 'PayPal',
    stripe: '信用卡',
    usdt: 'USDT',
    balance: '余额支付',
    scanQRCode: '扫码支付',
    paymentTimeout: '支付超时',
    paymentCancelled: '支付已取消',
    coupon: '优惠券',
    applyCoupon: '使用优惠券',
    discount: '优惠',
    actualPayment: '实付金额',
  },
  // 客服相关
  support: {
    ticket: '工单',
    createTicket: '创建工单',
    ticketList: '工单列表',
    ticketDetail: '工单详情',
    ticketStatus: '工单状态',
    reply: '回复',
    close: '关闭工单',
    liveChat: '在线客服',
    startChat: '开始聊天',
    endChat: '结束聊天',
    satisfaction: '满意度评价',
    rate: '评分',
    feedback: '反馈',
  },
  // 页脚
  footer: {
    copyright: '版权所有',
    allRightsReserved: '保留所有权利',
    termsOfService: '服务条款',
    privacyPolicy: '隐私政策',
    contactUs: '联系我们',
  },
}

// 英文翻译
const enTranslations: typeof zhTranslations = {
  common: {
    loading: 'Loading...',
    submit: 'Submit',
    cancel: 'Cancel',
    confirm: 'Confirm',
    save: 'Save',
    delete: 'Delete',
    edit: 'Edit',
    search: 'Search',
    reset: 'Reset',
    back: 'Back',
    close: 'Close',
    copy: 'Copy',
    copied: 'Copied',
    success: 'Success',
    error: 'Error',
    warning: 'Warning',
    info: 'Info',
    yes: 'Yes',
    no: 'No',
    all: 'All',
    none: 'None',
    more: 'More',
    less: 'Less',
    noData: 'No data',
    required: 'Required',
    optional: 'Optional',
    next: 'Next',
    prev: 'Previous',
    verify: 'Verify',
    send: 'Send',
    sending: 'Sending...',
    seconds: 's',
    clickRefresh: 'Click to refresh',
    fillComplete: 'Please fill in all required fields',
  },
  auth: {
    login: 'Login',
    register: 'Register',
    logout: 'Logout',
    loginTitle: 'User Login',
    loginSubtitle: 'Welcome back, please login to your account',
    registerTitle: 'User Registration',
    registerSubtitle: 'Create your account to start shopping',
    forgotTitle: 'Forgot Password',
    forgotStep1: 'Please enter your username',
    forgotStep2: 'Please verify your identity',
    forgotStep3: 'Please set your new password',
    verifyTitle: 'Two-Factor Authentication',
    verifySubtitle: 'Please complete verification to protect your account',
    noAccount: "Don't have an account? Register now",
    hasAccount: 'Already have an account? Login now',
    forgotPassword: 'Forgot password?',
    backToLogin: 'Back to login',
    backToHome: 'Back to home',
    registerNewAccount: 'Register new account',
    loginSuccess: 'Login successful',
    loginFailed: 'Login failed',
    registerSuccess: 'Registration successful, redirecting to login',
    registerFailed: 'Registration failed',
    verifySuccess: 'Verification successful',
    verifyFailed: 'Invalid verification code',
    resetSuccess: 'Password reset successful, redirecting to login',
    resetFailed: 'Reset failed',
    invalidRequest: 'Invalid verification request',
    infoExpired: 'Verification info has expired',
    userNotFound: 'User not found or email not bound',
  },
  nav: {
    home: 'Home',
    products: 'Products',
    user: 'Account',
    login: 'Login',
    register: 'Register',
    logout: 'Logout',
    faq: 'FAQ',
    support: 'Support',
    cart: 'Cart',
  },
  user: {
    username: 'Username',
    usernamePlaceholder: '3-20 characters',
    password: 'Password',
    passwordPlaceholder: 'Enter your password',
    passwordMinLength: 'At least 6 characters',
    passwordMismatch: 'Passwords do not match',
    passwordTooShort: 'Password must be at least 6 characters',
    confirmPassword: 'Confirm Password',
    confirmPasswordPlaceholder: 'Enter password again',
    confirmNewPassword: 'Confirm New Password',
    confirmNewPasswordPlaceholder: 'Enter new password again',
    email: 'Email',
    emailPlaceholder: 'For verification and password recovery',
    emailInvalid: 'Please enter a valid email address',
    emailFirst: 'Please enter email address first',
    phone: 'Phone',
    phonePlaceholder: 'Optional',
    phoneOptional: 'Phone (Optional)',
    avatar: 'Avatar',
    profile: 'Profile',
    settings: 'Settings',
    orders: 'My Orders',
    balance: 'Balance',
    recharge: 'Recharge',
    logoutSuccess: 'Logged out',
    pleaseLogin: 'Please login first',
    rememberMe: 'Remember me',
    resetPassword: 'Reset password',
    changePassword: 'Change password',
    oldPassword: 'Current password',
    newPassword: 'New password',
    newPasswordPlaceholder: 'At least 6 characters',
    twoFactorAuth: 'Two-factor authentication',
    enable2FA: 'Enable 2FA',
    disable2FA: 'Disable 2FA',
    verificationCode: 'Verification code',
    captcha: 'Captcha',
    captchaPlaceholder: 'Enter captcha',
    emailCode: 'Email verification code',
    emailCodePlaceholder: 'Enter {length}-digit code',
    sendCode: 'Send code',
    codeSent: 'Code sent, please check your email',
    codeSendFailed: 'Failed to send',
    codeCorrect: 'Code is correct',
    codeIncorrect: 'Code is incorrect or expired',
    totpCode: 'TOTP Code',
    totpPlaceholder: '000000',
    totpHint: 'Enter the code from your authenticator app',
    totpVerify: 'TOTP Verification',
    emailVerify: 'Email Verification',
    openAuthApp: 'Open your authenticator app to view the code',
    codeSendTo: 'Code will be sent to',
    verifyLogin: 'Verify & Login',
    enter6DigitCode: 'Please enter 6-digit code',
    enter6DigitTotp: 'Please enter 6-digit TOTP code',
    welcome: 'Welcome',
    hi: 'Hi',
  },
  product: {
    name: 'Product Name',
    description: 'Description',
    noDescription: 'No description',
    price: 'Price',
    stock: 'Stock',
    stockStatus: 'Stock Status',
    stockSufficient: 'In Stock',
    stockLow: 'Low Stock',
    stockRemaining: 'Remaining',
    stockUnit: 'pcs',
    outOfStock: 'Out of Stock',
    duration: 'Duration',
    category: 'Category',
    image: 'Image',
    detail: 'Product Details',
    specs: 'Specifications',
    features: 'Features',
    reviews: 'Reviews',
    reviewCount: 'reviews',
    noReviews: 'No reviews yet. You can leave a review after purchase.',
    buyNow: 'Buy Now',
    addToCart: 'Add to Cart',
    addedToCart: 'Added to cart',
    addFailed: 'Failed to add',
    quantity: 'Quantity',
    purchaseQuantity: 'Purchase Quantity',
    total: 'Total',
    totalPrice: 'Total Price',
    productList: 'Products',
    noProducts: 'No products',
    searchPlaceholder: 'Search products...',
    sortDefault: 'Default',
    sortPriceAsc: 'Price: Low to High',
    sortPriceDesc: 'Price: High to Low',
    foundProducts: 'Found {count} products',
    noMatchingProducts: 'No matching products found',
    tryOtherKeywords: 'Try other keywords?',
    clearSearch: 'Clear search',
    confirmPurchase: 'Confirm Purchase',
    purchaseSuccess: 'Purchase Successful',
    congratulations: 'Congratulations! Purchase successful!',
    orderCreated: 'Order created, redirecting to payment...',
    orderCreateFailed: 'Failed to create order',
    addToFavorite: 'Add to Favorites',
    removeFromFavorite: 'Remove from Favorites',
    addedToFavorite: 'Added to favorites',
    removedFromFavorite: 'Removed from favorites',
    operationFailed: 'Operation failed',
    merchantReply: 'Merchant Reply',
    score: 'pts',
  },
  order: {
    orderNo: 'Order No.',
    status: 'Status',
    createTime: 'Created',
    paymentTime: 'Paid',
    paymentMethod: 'Payment Method',
    amount: 'Amount',
    kamiCode: 'License Key',
    pending: 'Pending',
    paid: 'Paid',
    completed: 'Completed',
    cancelled: 'Cancelled',
    refunded: 'Refunded',
    expired: 'Expired',
    createOrder: 'Create Order',
    cancelOrder: 'Cancel Order',
    payNow: 'Pay Now',
    orderDetail: 'Order Details',
    orderList: 'Order List',
    noOrders: 'No orders',
    orderSuccess: 'Order placed',
    orderFailed: 'Order failed',
    paymentSuccess: 'Payment successful',
    paymentFailed: 'Payment failed',
    copyKami: 'Copy Key',
  },
  payment: {
    selectMethod: 'Select Payment Method',
    alipay: 'Alipay',
    wechat: 'WeChat Pay',
    paypal: 'PayPal',
    stripe: 'Credit Card',
    usdt: 'USDT',
    balance: 'Balance',
    scanQRCode: 'Scan to Pay',
    paymentTimeout: 'Payment timeout',
    paymentCancelled: 'Payment cancelled',
    coupon: 'Coupon',
    applyCoupon: 'Apply Coupon',
    discount: 'Discount',
    actualPayment: 'Total',
  },
  support: {
    ticket: 'Ticket',
    createTicket: 'Create Ticket',
    ticketList: 'Tickets',
    ticketDetail: 'Ticket Details',
    ticketStatus: 'Status',
    reply: 'Reply',
    close: 'Close Ticket',
    liveChat: 'Live Chat',
    startChat: 'Start Chat',
    endChat: 'End Chat',
    satisfaction: 'Satisfaction',
    rate: 'Rate',
    feedback: 'Feedback',
  },
  footer: {
    copyright: 'Copyright',
    allRightsReserved: 'All rights reserved',
    termsOfService: 'Terms of Service',
    privacyPolicy: 'Privacy Policy',
    contactUs: 'Contact Us',
  },
}

// 翻译字典
const translations: Record<Locale, typeof zhTranslations> = {
  zh: zhTranslations,
  en: enTranslations,
}

/**
 * 获取当前语言
 */
export function getLocale(): Locale {
  if (typeof window === 'undefined') return defaultLocale
  
  const stored = localStorage.getItem('locale')
  if (stored && locales.includes(stored as Locale)) {
    return stored as Locale
  }
  
  // 检测浏览器语言
  const browserLang = navigator.language.split('-')[0]
  if (locales.includes(browserLang as Locale)) {
    return browserLang as Locale
  }
  
  return defaultLocale
}

/**
 * 设置当前语言
 */
export function setLocale(locale: Locale): void {
  if (typeof window === 'undefined') return
  localStorage.setItem('locale', locale)
  window.location.reload()
}

/**
 * 获取翻译文本
 * @param key 翻译键，如 'common.loading'
 * @param locale 语言，默认使用当前语言
 */
export function t(key: string, locale?: Locale): string {
  const currentLocale = locale || getLocale()
  const dict = translations[currentLocale]
  
  const keys = key.split('.')
  let value: unknown = dict
  
  for (const k of keys) {
    if (value && typeof value === 'object' && k in value) {
      value = (value as Record<string, unknown>)[k]
    } else {
      return key // 找不到翻译时返回原始键
    }
  }
  
  return typeof value === 'string' ? value : key
}

/**
 * 获取整个翻译字典
 */
export function getTranslations(locale?: Locale): typeof zhTranslations {
  return translations[locale || getLocale()]
}

export default { t, getLocale, setLocale, getTranslations, locales, localeNames }
